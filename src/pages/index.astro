---
import Layout from '../layouts/Layout.astro';
import StopLegendItems from '../components/StopLegendItems.astro';
import PopupStyles from '../components/PopupStyles.astro';
---

<Layout title="KA Laufweite">
  <div id="map-shell">
    <div id="map"></div>
    <div id="legend">
      <h3>Legende</h3>
      <StopLegendItems />
      <p class="coverage" data-coverage-info></p>
      <p class="radius" data-radius-info></p>
      <p class="hint">
        Klicke auf die Karte, um eine eigene Haltestelle hinzuzufügen und ihren Typ zu wählen.
        Eigene Haltestellen sind verschiebbar und lassen sich per Popup entfernen. Darstellung und
        Distanzen stellst du unter Konfiguration ein.
      </p>
    </div>
  </div>
  <PopupStyles />
</Layout>

<script>
  import { initMap } from '../scripts/map';
  initMap();
</script>

<style>
  #map-shell {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 0;
  }

  #map {
    width: 100%;
    height: 100%;
  }

  #legend {
    position: absolute;
    bottom: 24px;
    left: 12px;
    z-index: 1000;
    background: white;
    padding: 12px 16px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    font-size: 14px;
    max-width: min(320px, calc(100% - 24px));
    max-height: min(330px, 52%);
    overflow: auto;
  }

  #legend h3 {
    margin-bottom: 8px;
    font-size: 15px;
  }

  #legend :global(.legend-toggle) {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 4px;
    width: 100%;
    border: 1px solid transparent;
    border-radius: 6px;
    background: transparent;
    padding: 2px 4px;
    text-align: left;
    font: inherit;
    color: inherit;
    cursor: pointer;
  }

  #legend :global(.legend-toggle:hover) {
    background: #f2f6fb;
  }

  #legend :global(.legend-toggle[aria-pressed='false']) {
    opacity: 0.45;
  }

  #legend :global(.legend-toggle:focus-visible) {
    outline: 2px solid #457b9d;
    outline-offset: 1px;
  }

  #legend :global(.dot) {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
  }

  .hint {
    margin-top: 8px;
    font-size: 12px;
    color: #666;
    max-width: 200px;
  }

  .radius {
    font-size: 12px;
    font-weight: 600;
    color: #1f2933;
  }

  .coverage {
    margin-top: 8px;
    font-size: 12px;
    font-weight: 600;
    color: #1f2933;
  }

  @media (max-width: 720px) {
    #legend {
      left: 8px;
      right: 8px;
      bottom: 8px;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 13px;
      max-width: none;
      max-height: 42%;
    }

    #legend h3 {
      margin-bottom: 6px;
      font-size: 14px;
    }

    .hint {
      max-width: none;
      font-size: 11px;
    }
  }

  @media (max-height: 500px) and (orientation: landscape) {
    #legend {
      top: 8px;
      left: 8px;
      right: auto;
      bottom: auto;
      width: min(300px, calc(100% - 16px));
      max-height: calc(100% - 16px);
    }
  }
</style>
